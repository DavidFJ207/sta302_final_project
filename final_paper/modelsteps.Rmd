# **1. Problem Definition**
- **Objective**: Define the goal of the model. For example:
  - Predict a continuous outcome (e.g., house price, sales revenue).
  - Identify key predictors affecting the outcome.
- Clearly state the research question or hypothesis.

# **2. Data Preparation**
This code prepares a dataset for multiple linear regression analysis by performing essential preprocessing steps. It begins by loading the dataset, defining the response variable (`CPI_Quarterly_Avg`), and identifying predictors (all columns except `Quarter` and the response). Missing values are removed to ensure data completeness, and duplicate rows are eliminated to avoid redundancy. Influential observations are identified using **Cook's Distance**, which measures the impact of each data point on the regression model. Observations with Cook's Distance exceeding the threshold \( \frac{4}{n - p} \) (where \( n \) is the number of observations and \( p \) is the number of predictors + 1) are excluded.

Removing influential points improves the model's accuracy and generalizability by reducing bias caused by anomalies. These points often violate regression assumptions, such as homoscedasticity and residual normality, and can disproportionately affect coefficient estimates. By addressing these issues, the cleaned dataset ensures a more reliable and interpretable regression model.
  
```{r}
# Load necessary libraries
library(tidyverse)
library(here)

# **Step 1: Load the dataset**
data <- read_csv(here::here("data/analysis_data/analysis_data.csv"))

# **Step 2: Define the response variable and predictors**
response <- "Quarterly_Average"
predictors <- setdiff(names(data), c("Quarter", response))

# Subset the relevant data
selected_data <- data %>%
  dplyr::select(c(response, all_of(predictors)))

# **Step 3: Clean Data**

## (a) Handle missing values
# Option 1: Remove rows with missing values
cleaned_data <- selected_data %>%
  drop_na()

## (b) Remove duplicates
cleaned_data <- cleaned_data %>%
  distinct()

## (c) Identify outliers using Cook's Distance
# Step 1: Fit an initial regression model
model <- lm(as.formula(paste(response, "~", paste(predictors, collapse = " + "))), data = cleaned_data)

# Step 2: Calculate Cook's Distance
cooks_d <- cooks.distance(model)

# Step 3: Identify influential points
influential_points <- which(cooks_d > 4 / (nrow(cleaned_data) - length(model$coefficients)))

# Step 4: Exclude influential observations
data <- cleaned_data[-influential_points, ]

```

# **3. Exploratory Data Analysis (EDA)**
#### 1. **Detached_Absorption_Quarterly_Avg**:
   - **Scatterplot Analysis**: The scatterplot confirms a clear negative relationship with `Quarterly_Average`, showing that higher absorption rates correlate with lower housing prices.
   - **Correlation**: Moderate negative correlation (\( r = -0.34 \)).
   - **Model Coefficient**: Significant negative effect (\( p = 0.049 \)), confirming its importance.
   - **Multicollinearity**: High VIF (32.63), signaling severe multicollinearity concerns.

#### 2. **Semi_Absorption_Quarterly_Avg**:
   - **Scatterplot Analysis**: The scatterplot shows a clear positive linear trend with `Quarterly_Average`, suggesting higher semi-absorption correlates with higher prices.
   - **Correlation**: Moderate positive correlation (\( r = 0.50 \)).
   - **Model Coefficient**: Not statistically significant (\( p = 0.291 \)).
   - **Multicollinearity**: Moderate VIF (20.56), indicating potential issues.

#### 3. **Detached_Unabsorbed_Quarterly_Avg**:
   - **Scatterplot Analysis**: Scatterplot demonstrates a positive relationship with `Quarterly_Average`, suggesting that more unabsorbed homes are associated with higher prices.
   - **Correlation**: Weak positive correlation (\( r = 0.28 \)).
   - **Model Coefficient**: Significant positive effect (\( p = 0.009 \)).
   - **Multicollinearity**: Low VIF (3.09), no concerns.

#### 4. **Semi_Unabsorbed_Quarterly_Avg**:
   - **Scatterplot Analysis**: Scatterplot shows a weak positive trend with `Quarterly_Average`, suggesting a minor influence.
   - **Correlation**: Weak positive correlation (\( r = 0.18 \)).
   - **Model Coefficient**: Not statistically significant (\( p = 0.400 \)).
   - **Multicollinearity**: Low VIF (7.81).

#### 5. **GDP_Quarterly_Avg**:
   - **Scatterplot Analysis**: A strong, clear positive linear relationship is evident in the scatterplot.
   - **Correlation**: Very strong positive correlation (\( r = 0.97 \)).
   - **Model Coefficient**: Significant negative effect (\( p = 0.004 \)), possibly confounded by its high correlation with CPI.
   - **Multicollinearity**: Extremely high VIF (98.96), requiring dimensionality reduction or removal.

#### 6. **CPI_Quarterly_Avg**:
   - **Scatterplot Analysis**: Strong positive linear relationship with `Quarterly_Average`.
   - **Correlation**: Very strong positive correlation (\( r = 0.98 \)).
   - **Model Coefficient**: Highly significant positive effect (\( p < 0.001 \)).
   - **Multicollinearity**: Extremely high VIF (81.84), driven by its correlation with GDP.

#### 7. **Starting_Detached_Construction**:
   - **Scatterplot Analysis**: Scatterplot reveals a weak negative trend with `Quarterly_Average`, indicating that more starts may reduce prices.
   - **Correlation**: Weak negative correlation (\( r = -0.18 \)).
   - **Model Coefficient**: Marginally significant negative effect (\( p = 0.060 \)).
   - **Multicollinearity**: High VIF (30.89), raising concerns.

#### 8. **Starting_Semi_Construction**:
   - **Scatterplot Analysis**: Scatterplot indicates a weak positive relationship with `Quarterly_Average`.
   - **Correlation**: Weak positive correlation (\( r = 0.37 \)).
   - **Model Coefficient**: Not statistically significant (\( p = 0.311 \)).
   - **Multicollinearity**: Moderate VIF (13.52).

#### 9. **Under_Construction_Detached**:
   - **Scatterplot Analysis**: A moderate positive trend is evident in the scatterplot.
   - **Correlation**: Moderate positive correlation (\( r = 0.37 \)).
   - **Model Coefficient**: Highly significant positive effect (\( p < 0.001 \)).
   - **Multicollinearity**: High VIF (29.29).

#### 10. **Under_Construction_Semi**:
   - **Scatterplot Analysis**: The scatterplot shows a moderate positive relationship with `Quarterly_Average`.
   - **Correlation**: Moderate positive correlation (\( r = 0.54 \)).
   - **Model Coefficient**: Significant positive effect (\( p = 0.031 \)).
   - **Multicollinearity**: High VIF (27.33).

#### 11. **Completed_Construction_Semi**:
   - **Scatterplot Analysis**: Strong positive trend with `Quarterly_Average` is visible in the scatterplot.
   - **Correlation**: Strong positive correlation (\( r = 0.80 \)).
   - **Model Coefficient**: Not statistically significant (\( p = 0.161 \)).
   - **Multicollinearity**: Moderate VIF (18.35).

#### 12. **Completed_Construction_Detached**:
   - **Scatterplot Analysis**: Scatterplot reveals a weak negative relationship with `Quarterly_Average`.
   - **Correlation**: Weak negative correlation (\( r = -0.29 \)).
   - **Model Coefficient**: Not statistically significant (\( p = 0.356 \)).
   - **Multicollinearity**: High VIF (32.95).

#### 13. **rates**:
   - **Scatterplot Analysis**: A clear negative trend is evident in the scatterplot.
   - **Correlation**: Moderate negative correlation (\( r = -0.60 \)).
   - **Model Coefficient**: Not statistically significant (\( p = 0.432 \)).
   - **Multicollinearity**: Low VIF (1.92), no concerns.

### General Observations:
- **Multicollinearity**: Severe multicollinearity exists for `GDP_Quarterly_Avg` and `CPI_Quarterly_Avg`, as shown in the correlation plot, requiring dimensionality reduction (e.g., PCA) or removal.
- **Insignificant Predictors**: Predictors like `Starting_Semi_Construction` and `Completed_Construction_Semi` show strong correlations but are not significant in the model, likely due to multicollinearity.
- **Interpretation and Improvement**: Addressing multicollinearity and removing insignificant predictors will improve model interpretability and reliability.

---
### Summary of Each Predictor

#### **1. Detached_Absorption_Quarterly_Avg**
- **Scatterplot Analysis**: Weak negative relationship with `Quarterly_Average`. Higher absorption rates seem to have minimal influence on prices.
- **Correlation**: Moderate negative correlation (\( r = -0.57 \)).
- **Model Coefficient**: Not statistically significant (\( p = 0.624 \)), suggesting little influence on the response variable.
- **Multicollinearity**: High VIF (50.54), indicating severe multicollinearity concerns.

#### **2. Semi_Absorption_Quarterly_Avg**
- **Scatterplot Analysis**: Weak negative relationship with `Quarterly_Average`.
- **Correlation**: Moderate negative correlation (\( r = -0.25 \)).
- **Model Coefficient**: Not statistically significant (\( p = 0.777 \)).
- **Multicollinearity**: Moderate VIF (24.25), indicating potential multicollinearity.

#### **3. Detached_Unabsorbed_Quarterly_Avg**
- **Scatterplot Analysis**: Clear positive relationship with `Quarterly_Average`, indicating more unabsorbed homes correlate with higher prices.
- **Correlation**: Moderate positive correlation (\( r = 0.45 \)).
- **Model Coefficient**: Significant positive effect (\( p = 0.001 \)), highlighting its importance.
- **Multicollinearity**: Low VIF (3.73), no concerns.

#### **4. Semi_Unabsorbed_Quarterly_Avg**
- **Scatterplot Analysis**: Weak positive relationship with `Quarterly_Average`.
- **Correlation**: Weak positive correlation (\( r = 0.38 \)).
- **Model Coefficient**: Not statistically significant (\( p = 0.743 \)).
- **Multicollinearity**: Low VIF (6.07), no major issues.

#### **5. GDP_Quarterly_Avg**
- **Scatterplot Analysis**: Strong positive relationship with `Quarterly_Average`, with GDP closely tracking price trends.
- **Correlation**: Very strong positive correlation (\( r = 0.97 \)).
- **Model Coefficient**: Highly significant negative effect (\( p < 0.001 \)), but likely confounded by CPI.
- **Multicollinearity**: Extremely high VIF (89.11), requiring dimensionality reduction.

#### **6. CPI_Quarterly_Avg**
- **Scatterplot Analysis**: Very strong positive relationship with `Quarterly_Average`.
- **Correlation**: Extremely strong positive correlation (\( r = 0.99 \)).
- **Model Coefficient**: Highly significant positive effect (\( p < 0.001 \)).
- **Multicollinearity**: Extremely high VIF (94.40), heavily correlated with GDP.

#### **7. Starting_Detached_Construction**
- **Scatterplot Analysis**: Weak negative relationship with `Quarterly_Average`.
- **Correlation**: Moderate negative correlation (\( r = -0.46 \)).
- **Model Coefficient**: Significant negative effect (\( p < 0.001 \)).
- **Multicollinearity**: High VIF (26.04), raising concerns.

#### **8. Starting_Semi_Construction**
- **Scatterplot Analysis**: Weak negative relationship with `Quarterly_Average`.
- **Correlation**: Weak negative correlation (\( r = -0.12 \)).
- **Model Coefficient**: Marginally significant positive effect (\( p = 0.071 \)).
- **Multicollinearity**: Low VIF (12.66), no major concerns.

#### **9. Under_Construction_Detached**
- **Scatterplot Analysis**: Moderate positive trend with `Quarterly_Average`.
- **Correlation**: Weak positive correlation (\( r = 0.26 \)).
- **Model Coefficient**: Highly significant positive effect (\( p < 0.001 \)).
- **Multicollinearity**: Moderate VIF (23.09).

#### **10. Under_Construction_Semi**
- **Scatterplot Analysis**: Weak positive relationship with `Quarterly_Average`.
- **Correlation**: Weak positive correlation (\( r = 0.06 \)).
- **Model Coefficient**: Not statistically significant (\( p = 0.256 \)).
- **Multicollinearity**: Moderate VIF (32.62), indicating some issues.

#### **11. Completed_Construction_Semi**
- **Scatterplot Analysis**: Strong positive trend with `Quarterly_Average`.
- **Correlation**: Strong positive correlation (\( r = 0.72 \)).
- **Model Coefficient**: Significant negative effect (\( p = 0.040 \)), potentially counterintuitive.
- **Multicollinearity**: Moderate VIF (12.00), no major concerns.

#### **12. Completed_Construction_Detached**
- **Scatterplot Analysis**: Weak negative relationship with `Quarterly_Average`.
- **Correlation**: Moderate negative correlation (\( r = -0.48 \)).
- **Model Coefficient**: Not statistically significant (\( p = 0.111 \)).
- **Multicollinearity**: High VIF (53.73), indicating severe multicollinearity.

#### **13. Rates**
- **Scatterplot Analysis**: Weak negative relationship with `Quarterly_Average`.
- **Correlation**: Weak negative correlation (\( r = -0.26 \)).
- **Model Coefficient**: Not statistically significant (\( p = 0.273 \)).
- **Multicollinearity**: Low VIF (2.14), no concerns.

---

### General Observations:
1. **Multicollinearity**:
   - Severe multicollinearity exists for `GDP_Quarterly_Avg` and `CPI_Quarterly_Avg` with VIFs exceeding 90, necessitating dimensionality reduction techniques (e.g., PCA) or predictor removal.
   - Predictors such as `Detached_Absorption_Quarterly_Avg` and `Completed_Construction_Detached` also show high VIFs, impacting model reliability.

2. **Significant Predictors**:
   - Key predictors like `Detached_Unabsorbed_Quarterly_Avg`, `GDP_Quarterly_Avg`, and `CPI_Quarterly_Avg` show significant effects, highlighting their importance in explaining price trends.

3. **Insignificant Predictors**:
   - Predictors like `Starting_Semi_Construction` and `Under_Construction_Semi` lack statistical significance despite moderate correlations, likely due to multicollinearity.

4. **Influential Points**:
   - Two influential points (observations 1 and 4) were identified using Cook’s Distance, indicating potential leverage effects that should be further investigated.

5. **Model Fit**:
   - The model shows high \( R^2 \) (99.64%), but the presence of multicollinearity and influential points suggests overfitting or instability in coefficient estimates.

Addressing multicollinearity and further refining the model by removing or transforming predictors will enhance its interpretability and robustness.

# **4. Specify the Model**
The multiple linear regression (MLR) model for **Quarterly_Average** has been revised to include the most significant predictors based on exploratory data analysis (EDA), regression coefficients, and multicollinearity analysis. The updated equation is:

\[
Y = \beta_0 + \beta_1 \text{Detached\_Absorption\_Quarterly\_Avg} + \beta_2 \text{Starting\_Detached\_Construction} + \beta_3 \text{Detached\_Unabsorbed\_Quarterly\_Avg} + \beta_4 \text{Under\_Construction\_Detached} + \beta_5 \text{Completed\_Construction\_Semi} + \beta_6 \text{CPI\_Quarterly\_Avg} + \epsilon
\]

#### Key Components:
1. **Response Variable (\(Y\))**:
   - \(Y = \text{Quarterly_Average}\): Represents the average quarterly housing prices.

2. **Predictors (\(X_j\))**:
   - \(X_1\): **Detached_Absorption_Quarterly_Avg** (\(p = 0.049\)):
     - A significant negative predictor, indicating higher absorption rates reduce \(Y\).
     - Shows high multicollinearity (VIF = 32.63).
   - \(X_2\): **Starting_Detached_Construction** (\(p < 0.001\)):
     - A significant negative predictor, where more detached housing starts lower \(Y\).
     - Moderate multicollinearity (VIF = 30.89).
   - \(X_3\): **Detached_Unabsorbed_Quarterly_Avg** (\(p = 0.009\)):
     - Significant positive predictor, suggesting that more unabsorbed homes increase \(Y\).
     - Low multicollinearity (VIF = 3.09).
   - \(X_4\): **Under_Construction_Detached** (\(p < 0.001\)):
     - A significant positive predictor showing that ongoing detached housing construction raises \(Y\).
     - Moderate multicollinearity (VIF = 29.29).
   - \(X_5\): **Completed_Construction_Semi** (\(p = 0.011\)):
     - A significant negative predictor, though the effect is counterintuitive.
     - Moderate multicollinearity (VIF = 18.35).
   - \(X_6\): **CPI_Quarterly_Avg** (\(p < 0.001\)):
     - A highly significant positive predictor, showing a strong positive impact on \(Y\).
     - Severe multicollinearity (VIF = 81.84), requiring further adjustment.

3. **Coefficients (\(\beta_j\))**:
   - Represent the average change in \(Y\) for a one-unit change in the respective predictor while holding all other predictors constant.

4. **Error Term (\(\epsilon\))**:
   - Accounts for variability in \(Y\) not explained by the predictors.

---

### Justification for Predictor Selection:
1. **Statistical Significance**:
   - Predictors included have \(p < 0.05\), showing significant relationships with \(Quarterly_Average\).
   - Retaining `CPI_Quarterly_Avg` and `Detached_Absorption_Quarterly_Avg` due to their theoretical importance despite high multicollinearity.

2. **Multicollinearity**:
   - High multicollinearity for `CPI_Quarterly_Avg` (VIF = 81.84) and `Detached_Absorption_Quarterly_Avg` (VIF = 32.63) indicates potential instability in coefficient estimates.
   - Future refinements may involve PCA or variable elimination to reduce collinearity.

3. **Simplification**:
   - Insignificant predictors such as `Rates`, `Semi_Unabsorbed_Quarterly_Avg`, and `Completed_Construction_Detached` were excluded for better interpretability and to prevent overfitting.

# **5. Fit the Model**

### Thorough Summary of the Model:

This multiple linear regression model predicts the Box-Cox transformed quarterly average housing prices (\( bc\_Quarterly\_Average \)) using key predictors selected for their statistical significance and theoretical relevance. The model explains 98.39% of the variance in the response variable (\( R^2 = 0.9839 \), \( Adj. R^2 = 0.9806 \)), indicating a very strong fit. Significant predictors include:

- **CPI_Quarterly_Avg** (\( p = 2.34e-11 \), \( \beta = 1.1978 \)): A highly significant positive effect, reinforcing its importance as an economic indicator influencing housing prices.
- **Log_Detached_Unabsorbed_Quarterly_Avg** (\( p = 8.58e-05 \), \( \beta = 17.7358 \)): A strong positive relationship, suggesting that higher numbers of unabsorbed detached homes drive up average prices.
- **Log_Under_Construction_Detached** (\( p = 9.90e-06 \), \( \beta = 36.9355 \)): Another significant positive predictor, highlighting the role of ongoing construction in increasing housing prices.
- **Log_Detached_Absorption_Quarterly_Avg** (\( p = 0.0293 \), \( \beta = -11.9536 \)): A significant negative relationship, implying that higher absorption rates correlate with reduced prices.

Less significant predictors include:
- **Log_Starting_Detached_Construction** (\( p = 0.0831 \)): Marginally significant with a negative effect.
- **Log_Completed_Construction_Semi** (\( p = 0.1387 \)): Not statistically significant but retained for theoretical reasons.

The residual standard error of 2.509 and a highly significant \( F \)-statistic (\( p < 2.2e-16 \)) further confirm the robustness of the model.

### Explanation of the Steps Taken:

1. **Transforming Predictors**:
   - Log transformations were applied to variables like **Detached_Absorption_Quarterly_Avg**, **Starting_Detached_Construction**, and **Under_Construction_Detached** to address skewness and stabilize variance.
   - **CPI_Quarterly_Avg** was standardized to mitigate multicollinearity, as it exhibited extreme VIF values due to its strong correlation with other predictors.

2. **Box-Cox Transformation**:
   - The response variable (\( Quarterly\_Average \)) was Box-Cox transformed to address skewness and heteroscedasticity in the residuals, improving model diagnostics and ensuring adherence to linear regression assumptions.

3. **Multicollinearity Analysis**:
   - Variance Inflation Factor (VIF) values were calculated for all predictors, showing improvement across most variables. The highest VIFs were 11.20 (CPI_Quarterly_Avg) and 10.83 (Completed_Construction_Semi), which are acceptable compared to prior extreme multicollinearity concerns.

4. **Model Fitting and Diagnostics**:
   - The transformed predictors and response variable were used to fit the linear regression model. Diagnostic plots and tests (e.g., residual analysis, normality checks) indicated that the model adhered to assumptions of normality, homoscedasticity, and linearity.

### Key Improvements:
- Addressed multicollinearity concerns, especially for **CPI_Quarterly_Avg**, through standardization and variable transformations.
- Achieved better adherence to regression assumptions through log and Box-Cox transformations.
- Retained theoretically relevant predictors, even those with marginal significance, for a more interpretable model.

This model effectively balances statistical rigor and theoretical insights, producing a robust, interpretable equation for predicting quarterly average housing prices.

# **6. Interpret the Results**

# **7. Diagnostics and Assumptions Checking**

#### **1. Variance Inflation Factor (VIF) Analysis**
- The VIF values indicate moderate to high multicollinearity among predictors:
  - **CPI_Quarterly_Avg** has the highest VIF (11.2), suggesting some multicollinearity concerns.
  - **log_Under_Construction_Detached** and **log_Completed_Construction_Semi** also have elevated VIFs (>10), which may affect the stability of their coefficients.
  - The remaining predictors, including **log_Starting_Detached_Construction** and **log_Detached_Unabsorbed_Quarterly_Avg**, show acceptable VIF values (<5).
- **Actionable Insight**: While not severe, multicollinearity might require attention (e.g., using regularization methods like Ridge regression) if model stability issues arise.

---

#### **2. Cook’s Distance Plot (Influential Points)**
- The Cook’s Distance plot identifies potential influential observations. Points with Cook's Distance exceeding the red threshold line (typically \(4/n\)) have a disproportionate impact on the model:
  - Observation 10 shows the highest influence but is below critical thresholds, suggesting it is not unduly affecting the model.
- **Actionable Insight**: The dataset appears robust, with no extreme influential points. However, further investigation of observation 10 might be warranted.

---

#### **3. Normal Q-Q Plot**
- The Q-Q plot assesses the normality of residuals:
  - Residuals align closely with the red diagonal line, except for slight deviations at the tails, indicating that most residuals are approximately normal.
  - Tail deviations may represent minor outliers or non-normality but are not severe enough to compromise the model.
- **Actionable Insight**: Residuals are close to normal. No immediate transformation of the response variable is required.

---

#### **4. Residuals vs Fitted Values**
- This plot examines linearity and homoscedasticity:
  - Residuals are roughly scattered around the red dashed line (indicating zero error), supporting the assumption of linearity.
  - Some variance heteroscedasticity (uneven spread) is observed, with slightly larger residuals at higher fitted values.
- **Actionable Insight**: The model meets the linearity assumption but could benefit from techniques to address mild heteroscedasticity, such as weighted least squares or variance-stabilizing transformations.

---

#### **5. Residuals vs Predictors**
The residuals were plotted against each predictor to check individual linearity and the contribution of predictors:
1. **log_Detached_Absorption_Quarterly_Avg**:
   - Residuals show no systematic pattern, supporting linearity for this predictor.
2. **log_Starting_Detached_Construction**:
   - Slight non-linearity or clustering is visible. This could suggest a need for interaction terms or higher-order transformations.
3. **log_Detached_Unabsorbed_Quarterly_Avg**:
   - Residuals are scattered, with no discernible pattern, supporting linearity.
4. **log_Under_Construction_Detached**:
   - Some clustering is present, indicating a potential interaction effect or a non-linear relationship.
5. **log_Completed_Construction_Semi**:
   - Similar to other predictors, the residuals show reasonable scatter, with no major deviations.
6. **std_CPI_Quarterly_Avg**:
   - Residuals show good scatter, indicating linearity for this standardized predictor.

- **Actionable Insight**: While most predictors support linearity, slight clustering for **log_Starting_Detached_Construction** and **log_Under_Construction_Detached** suggests exploring interaction terms or polynomial expansions.

---

#### **6. Histogram of Residuals (Not Shown in Images)**
- The histogram would confirm whether residuals are symmetrically distributed around zero.
- From the Q-Q plot, we infer approximate normality, but the histogram would further validate this.

---

### **Overall Model Diagnostics**
- **Strengths**:
  - Residuals largely meet assumptions of linearity and normality.
  - No extreme influential points or outliers were identified.
  - Most predictors have acceptable VIF values, supporting the robustness of the model.

- **Weaknesses**:
  - Mild heteroscedasticity in the residuals vs. fitted values plot.
  - Slight non-linearity in specific predictors (e.g., **log_Starting_Detached_Construction**).

### **Recommendations for Improvement**
1. **Address Multicollinearity**
2. **Explore Non-Linearity**:
   - Add interaction terms or polynomial expansions for predictors showing clustering in residuals ( **log_Under_Construction_Detached**).
3. **Check Heteroscedasticity**:
   - Apply weighted least squares or investigate transformations to stabilize residual variance.
4. **Investigate Observation 10**:
   - While not extreme, this observation has the highest Cook’s Distance and may warrant closer examination.


# **8. Model Refinement**
  
```{r}
# Load required libraries
library(car)          # For Box-Cox transformations
library(MASS)         # For stepwise regression (AIC, BIC)
library(caret)        # For cross-validation

# Step 1: Specify Predictors
predictors <- c("Detached_Absorption_Quarterly_Avg", 
                "Starting_Detached_Construction", 
                "Detached_Unabsorbed_Quarterly_Avg", 
                "Under_Construction_Detached", 
                "Completed_Construction_Semi", 
                "CPI_Quarterly_Avg")

# Subset the data to include only relevant predictors and the response variable
data_subset <- data[, c(predictors, "Quarterly_Average")]

# Step 2: Transform Variables
# Apply log transformations to handle non-linearity or heteroskedasticity
data_subset$Completed_Construction_Semi_log <- log(data_subset$Completed_Construction_Semi + 1)  # Log transformation
data_subset$Detached_Unabsorbed_Quarterly_Avg_log <- log(data_subset$Detached_Unabsorbed_Quarterly_Avg + 1)  # Log transformation

# Apply Box-Cox transformation to the response variable if necessary
boxcox_model <- lm(Quarterly_Average ~ ., data = data_subset)  # Fit a linear model
boxcox(boxcox_model, lambda = seq(-2, 2, 0.1))  # Evaluate Box-Cox transformation
# Based on the suggested lambda, apply the transformation
lambda <- 0.5  # Replace with the suggested lambda value
data_subset$Quarterly_Average <- (data_subset$Quarterly_Average^lambda - 1) / lambda  # Box-Cox transformation

# Step 3: Add Interaction Terms
# Adding interaction terms based on findings from residual analysis
data_subset$Interaction_Detached_Absorption <- data_subset$Detached_Absorption_Quarterly_Avg * data_subset$Under_Construction_Detached
data_subset$Interaction_Construction_Semi <- data_subset$Starting_Detached_Construction * data_subset$Completed_Construction_Semi_log

# Step 4: Update the Model to Include Selected Predictors
# Fit the linear model using only specified predictors, transformations, and interactions
model <- lm(Quarterly_Average ~ Detached_Absorption_Quarterly_Avg + 
                                     Starting_Detached_Construction + 
                                     Detached_Unabsorbed_Quarterly_Avg_log + 
                                     Under_Construction_Detached + 
                                     Completed_Construction_Semi_log + 
                                     Interaction_Detached_Absorption + 
                                     Interaction_Construction_Semi+CPI_Quarterly_Avg,
            data = data_subset)

# Step 5: Evaluate the Model
summary(model)

# Step 6: Feature Selection Using Stepwise Regression
# Use stepwise regression to refine the model
stepwise_model <- stepAIC(model, direction = "both", trace = FALSE)
summary(stepwise_model)

# Step 7: Cross-Validation
# Define cross-validation control
train_control <- trainControl(method = "cv", number = 10)

# Fit the model with cross-validation
cv_model <- train(Quarterly_Average ~ Detached_Absorption_Quarterly_Avg + 
                                      Starting_Detached_Construction + 
                                      Detached_Unabsorbed_Quarterly_Avg_log + 
                                      Under_Construction_Detached + 
                                      Completed_Construction_Semi_log + 
                                      Interaction_Detached_Absorption + 
                                      Interaction_Construction_Semi,
                  data = data_subset,
                  method = "lm",
                  trControl = train_control)

# Print cross-validation results
print(cv_model)

```

## **Summary of Findings**
#### **Model Summary**:
- The model was built to predict the `Quarterly_Average` response variable using seven predictors, including transformed and interaction terms.


#### **Residuals**:
- The residuals show minimal spread, with most residuals close to zero, indicating a good fit overall:
  - Minimum: -0.50629
  - Maximum: 0.43840
  - Median: -0.00234
- The residual standard error is **0.2225**, which is slightly higher than in the previous model but still reasonable.



#### **Key Metrics**:
- **R-squared**: 0.9875
  - Indicates that **98.75%** of the variance in `Quarterly_Average` is explained by the model.
- **Adjusted R-squared**: 0.986
  - Adjusts for the number of predictors, confirming a high level of explained variance with minimal risk of overfitting.
- **F-statistic**: 659.3 (p-value < 2.2e-16)
  - The model remains highly statistically significant.

#### **Significant Predictors**:
1. **Detached_Absorption_Quarterly_Avg**:
   - Estimate: \( 3.001 \times 10^{-4} \)
   - p-value: 0.15563 (not significant).
   - Suggests a weak positive relationship, but the effect is not statistically significant.

2. **Starting_Detached_Construction**:
   - Estimate: -0.0003929
   - p-value: 0.13240 (not significant).
   - Indicates a weak negative effect on `Quarterly_Average`, though not statistically significant.

3. **Detached_Unabsorbed_Quarterly_Avg_log**:
   - Estimate: 1.393
   - p-value: \( 7.21 \times 10^{-8} \) (***).
   - A **strong positive relationship**, confirming its importance as a key predictor.

4. **Under_Construction_Detached**:
   - Estimate: \( 1.291 \times 10^{-4} \)
   - p-value: \( 9.17 \times 10^{-7} \) (***).
   - A **significant positive effect**, suggesting that more under-construction detached units increase `Quarterly_Average`.

5. **Completed_Construction_Semi_log**:
   - Estimate: -2.305
   - p-value: 0.00484 (**).
   - A significant **negative relationship**, indicating that more completed semi-detached constructions decrease `Quarterly_Average`.

6. **Interaction_Detached_Absorption**:
   - Estimate: \( -9.626 \times 10^{-9} \)
   - p-value: 0.02287 (*).
   - A significant **negative interaction effect**, though relatively small in magnitude.

7. **Interaction_Construction_Semi**:
   - Estimate: \( 4.124 \times 10^{-5} \)
   - p-value: 0.16234 (not significant).
   - Suggests a weak positive interaction effect, though it is not statistically significant.

8. **CPI_Quarterly_Avg**:
   - Estimate: 0.1377
   - p-value: \( < 2 \times 10^{-16} \) (***).
   - The most significant predictor with a very strong **positive relationship**.


#### **Cross-Validation Results**:
- **RMSE (Root Mean Squared Error)**: 0.718
  - Slight improvement over the previous model (0.732), indicating better predictive accuracy.
- **R-squared**: 0.874
  - During cross-validation, the model explains **87.4%** of the variance, similar to the previous model's performance.
- **MAE (Mean Absolute Error)**: 0.621
  - Suggests a reasonable average prediction error, slightly higher than before.


#### **Conclusions**:
1. The model is robust, explaining a high percentage of variance in the response variable (**Adjusted \( R^2 \): 98.6%**).
2. Key predictors include:
   - **Detached_Unabsorbed_Quarterly_Avg_log** and **CPI_Quarterly_Avg**: Most significant positive relationships.
   - **Completed_Construction_Semi_log**: Strong negative effect.
3. Cross-validation results validate the model’s performance with consistent results (\( R^2 = 0.874 \)).
4. Interaction terms have mixed significance:
   - **Interaction_Detached_Absorption**: Significant negative effect.
   - **Interaction_Construction_Semi**: Not statistically significant.
5. Some predictors (e.g., **Detached_Absorption_Quarterly_Avg**, **Starting_Detached_Construction**) are not statistically significant and could be reconsidered for removal.
6. Diagnostic residual checks suggest mild non-normality and possible heteroskedasticity, which may require further investigation.

Would you like suggestions on refining the model or addressing specific issues, such as predictor selection or transformations?


## Predictor Removal
```{r}
# Load necessary libraries
library(MASS)    # For stepAIC function
library(caret)   # For cross-validation
library(car)     # For Box-Cox transformation

# Step 1: Data Preparation and Initial Model
# Fit the initial full model with all predictors
full_model <- lm(Quarterly_Average ~ ., data = data)

# Step 2: Box-Cox Transformation (if necessary)
# Check if a transformation is needed for the response variable
boxcox_result <- boxcox(full_model, lambda = seq(-2, 2, 0.1))  # Evaluate lambda
lambda_optimal <- boxcox_result$x[which.max(boxcox_result$y)]  # Optimal lambda
if (lambda_optimal != 1) {
  data$Quarterly_Average <- (data$Quarterly_Average^lambda_optimal - 1) / lambda_optimal
  cat("Applied Box-Cox transformation with lambda =", lambda_optimal, "\n")
}

# Step 3: Stepwise Selection using AIC
# Perform stepwise regression to select the best model based on AIC
stepwise_aic <- stepAIC(full_model, direction = "both", trace = FALSE)
cat("AIC-Selected Model Summary:\n")
summary(stepwise_aic)

# Step 4: Stepwise Selection using BIC
# Perform stepwise regression to select the best model based on BIC
stepwise_bic <- stepAIC(full_model, direction = "both", k = log(nrow(data)))
cat("BIC-Selected Model Summary:\n")
summary(stepwise_bic)

# Step 5: Compare AIC and BIC Models
# Fit models based on AIC- and BIC-selected predictors
aic_selected_model <- lm(formula(stepwise_aic), data = data)
bic_selected_model <- lm(formula(stepwise_bic), data = data)

# Print summaries for comparison
cat("AIC-Selected Model Coefficients:\n")
print(coef(aic_selected_model))
cat("BIC-Selected Model Coefficients:\n")
print(coef(bic_selected_model))

# Step 6: Cross-Validation for Model Validation
set.seed(123)  # For reproducibility
train_control <- trainControl(method = "cv", number = 10)  # 10-fold cross-validation

# Cross-validate the AIC-selected model
cv_aic <- train(
  formula(stepwise_aic),
  data = data,
  method = "lm",
  trControl = train_control
)
cat("Cross-Validation Results for AIC-Selected Model:\n")
print(cv_aic)

# Cross-validate the BIC-selected model
cv_bic <- train(
  formula(stepwise_bic),
  data = data,
  method = "lm",
  trControl = train_control
)
cat("Cross-Validation Results for BIC-Selected Model:\n")
print(cv_bic)

# Step 7: Diagnostic Plots for Residual Analysis
# Plot diagnostic plots for both models
par(mfrow = c(2, 2))  # Arrange plots
cat("Diagnostic Plots for AIC-Selected Model:\n")
plot(aic_selected_model)
cat("Diagnostic Plots for BIC-Selected Model:\n")
plot(bic_selected_model)


```

## **Summary of Findings**

### Key Findings

#### **Box-Cox Transformation**
- A Box-Cox transformation was applied with \( \lambda = -0.3434 \), indicating the response variable needed normalization for improved model fit.

---

#### **AIC-Selected Model**
- **Model Summary**:
  - Includes 10 predictors.
  - **Residual Standard Error**: \( 0.0041 \).
  - **Multiple R-squared**: \( 0.9924 \), **Adjusted R-squared**: \( 0.9912 \).
  - **F-statistic**: \( 844.5 \) (p-value < \( 2.2 \times 10^{-16} \)).
  - **Key Predictors**:
    - **Highly significant predictors (\( p < 0.001 \))**:
      - `Detached_Absorption_Quarterly_Avg`, `Detached_Unabsorbed_Quarterly_Avg`, `GDP_Quarterly_Avg`, `CPI_Quarterly_Avg`, `Starting_Detached_Construction`, `Under_Construction_Detached`.
    - **Moderately significant predictors (\( p < 0.05 \))**:
      - `Semi_Unabsorbed_Quarterly_Avg`, `Under_Construction_Semi`, `Completed_Construction_Semi`.

- **Cross-Validation Results**:
  - **RMSE**: \( 0.00442 \), **R-squared**: \( 0.9924 \), **MAE**: \( 0.00367 \).

---

#### **BIC-Selected Model**
- **Model Summary**:
  - Includes 8 predictors (fewer than AIC-selected model).
  - **Residual Standard Error**: \( 0.0042 \).
  - **Multiple R-squared**: \( 0.9916 \), **Adjusted R-squared**: \( 0.9906 \).
  - **F-statistic**: \( 989.2 \) (p-value < \( 2.2 \times 10^{-16} \)).
  - **Key Predictors**:
    - **Highly significant predictors (\( p < 0.001 \))**:
      - `Detached_Absorption_Quarterly_Avg`, `Detached_Unabsorbed_Quarterly_Avg`, `GDP_Quarterly_Avg`, `CPI_Quarterly_Avg`, `Starting_Detached_Construction`, `Under_Construction_Detached`.
    - **Moderately significant predictors (\( p < 0.05 \))**:
      - `Semi_Unabsorbed_Quarterly_Avg`, `Under_Construction_Semi`.

- **Cross-Validation Results**:
  - **RMSE**: \( 0.00437 \), **R-squared**: \( 0.9928 \), **MAE**: \( 0.00366 \).

---

#### **Comparison of AIC and BIC Models**
- Both models perform exceptionally well with high \( R^2 \) values, low RMSE, and low MAE.
- **Differences**:
  - The AIC model includes two additional predictors: `Starting_Semi_Construction` and `Completed_Construction_Semi`.
  - BIC prioritizes a simpler model with fewer predictors while retaining similar performance metrics.

---

#### **Diagnostic Plots**
- Diagnostic plots for both models suggest no major violations of regression assumptions:
  - Residuals are normally distributed with no clear patterns.
  - Homoscedasticity is maintained.
  - No highly influential outliers observed.

---

#### **Conclusions**
1. **Model Selection**:
   - The BIC-selected model is more parsimonious with only 8 predictors and minimal performance loss compared to the AIC-selected model.
   - For simplicity, the BIC model may be preferred unless specific applications demand the additional predictors in the AIC model.

2. **Key Predictors**:
   - Consistent significant predictors across both models include:
     - `Detached_Absorption_Quarterly_Avg`, `Detached_Unabsorbed_Quarterly_Avg`, `GDP_Quarterly_Avg`, `CPI_Quarterly_Avg`, `Starting_Detached_Construction`, and `Under_Construction_Detached`.

3. **Validation**:
   - Cross-validation results confirm the reliability of both models, with RMSE and MAE values remaining low across folds.

4. **Recommendation**:
   - Opt for the BIC model if simplicity is critical.
   - Retain the AIC model for a slightly more comprehensive analysis at the cost of additional complexity.

# **9. Reporting the Model**

```{r}
# Load necessary libraries
library(caret)   # For cross-validation
library(ggplot2) # For diagnostic visualization

# Define the final model formula based on BIC-selected predictors
final_model_formula <- Quarterly_Average ~ 
  Detached_Absorption_Quarterly_Avg + 
  Detached_Unabsorbed_Quarterly_Avg + 
  Semi_Unabsorbed_Quarterly_Avg + 
  GDP_Quarterly_Avg + 
  CPI_Quarterly_Avg + 
  Starting_Detached_Construction + 
  Under_Construction_Detached + 
  Under_Construction_Semi

# Fit the final model
final_model <- lm(final_model_formula, data = data)
cat("Final Model Summary:\n")
summary(final_model)

# Validate the model using cross-validation
set.seed(123)  # For reproducibility
train_control <- trainControl(method = "cv", number = 10)  # 10-fold cross-validation

# Cross-validation
cv_final_model <- train(
  final_model_formula,
  data = data,
  method = "lm",
  trControl = train_control
)
cat("Cross-Validation Results for Final Model:\n")
print(cv_final_model)

# Diagnostic plots for the final model
par(mfrow = c(2, 2))  # Arrange diagnostic plots
plot(final_model)

# Visualize residuals to confirm normality
ggplot(data.frame(residuals = resid(final_model)), aes(x = residuals)) +
  geom_histogram(bins = 30, color = "black", fill = "skyblue") +
  labs(title = "Residuals Histogram", x = "Residuals", y = "Frequency")

# Validate model performance
cat("Final Model Performance:\n")
cat("RMSE:", sqrt(mean(resid(final_model)^2)), "\n")  # Calculate RMSE
cat("R-squared:", summary(final_model)$r.squared, "\n")  # R-squared
cat("Adjusted R-squared:", summary(final_model)$adj.r.squared, "\n")  # Adjusted R-squared

```